---
layout: post
title: "C函数的调用栈"
date: 2017-07-09
category: linux
keywords: linux, C, frame
---

StackFrame.c文件中的主要功能代码如下：
```
#include <stdio.h>
#include <string.h>

struct Strt{
    int member1;
    int member2;
    int member3;
};

#define PRINT_ADDR(x)     printf("&"#x" = %p\n", &x)
int StackFrameContent(int para1, int para2, int para3){
    int locVar1 = 1;
    int locVar2 = 2;
    int locVar3 = 3;
    int arr[] = {0x11,0x22,0x33};
    struct Strt tStrt = {0};
    PRINT_ADDR(para1); //若para1为char或short型，则打印para1所对应的栈上整型临时变量地址！
    PRINT_ADDR(para2);
    PRINT_ADDR(para3);
    PRINT_ADDR(locVar1);
    PRINT_ADDR(locVar2);
    PRINT_ADDR(locVar3);
    PRINT_ADDR(arr);
    PRINT_ADDR(arr[0]);
    PRINT_ADDR(arr[1]);
    PRINT_ADDR(arr[2]);
    PRINT_ADDR(tStrt);
    PRINT_ADDR(tStrt.member1);
    PRINT_ADDR(tStrt.member2);
    PRINT_ADDR(tStrt.member3);
    return 0;
}

int main(void){
    int locMain1 = 1, locMain2 = 2, locMain3 = 3;
    PRINT_ADDR(locMain1);
    PRINT_ADDR(locMain2);
    PRINT_ADDR(locMain3);
    StackFrameContent(locMain1, locMain2, locMain3);
    printf("[locMain1,2,3] = [%d, %d, %d]\n", locMain1, locMain2, locMain3);
    memset(&locMain2, 0, 2*sizeof(int));
    printf("[locMain1,2,3] = [%d, %d, %d]\n", locMain1, locMain2, locMain3);
    return 0;
}

```

编译链接并执行后，输出打印如下：
```
[zhangchaowei@bogon tmp]$ gcc -g c_frame.c 
[zhangchaowei@bogon tmp]$ ls
a.out  c_frame.c
[zhangchaowei@bogon tmp]$ 
[zhangchaowei@bogon tmp]$ 
[zhangchaowei@bogon tmp]$ ./a.out 
&locMain1 = 0x7ffc08ab4a9c
&locMain2 = 0x7ffc08ab4a98
&locMain3 = 0x7ffc08ab4a94
&para1 = 0x7ffc08ab4a4c
&para2 = 0x7ffc08ab4a48
&para3 = 0x7ffc08ab4a44
&locVar1 = 0x7ffc08ab4a7c
&locVar2 = 0x7ffc08ab4a78
&locVar3 = 0x7ffc08ab4a74
&arr = 0x7ffc08ab4a60
&arr[0] = 0x7ffc08ab4a60
&arr[1] = 0x7ffc08ab4a64
&arr[2] = 0x7ffc08ab4a68
&tStrt = 0x7ffc08ab4a50
&tStrt.member1 = 0x7ffc08ab4a50
&tStrt.member2 = 0x7ffc08ab4a54
&tStrt.member3 = 0x7ffc08ab4a58
[locMain1,2,3] = [1, 2, 3]
[locMain1,2,3] = [0, 0, 3]
[zhangchaowei@bogon tmp]$ 
```

